Man who faced 20 years for marijuana possession freed after legal battle