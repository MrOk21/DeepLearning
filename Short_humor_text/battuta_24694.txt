Democrats agree to compromise on superdelegates and other reforms